<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <data>

        <!-- Action -->
        <record id="action_get_contract_context" model="ir.actions.server">
            <field name="name">Generate Context for Contract</field>
            <field name="model_id" ref="client_contracts.model_res_partner_contract_wizard"/>
            <field name="binding_model_id" ref="client_contracts.model_res_partner_contract_wizard" />
            <field name="state">code</field>
            <field name="code">

# Aliases
self = record
partner = self.partner_id # res.partner
partner_bank = partner.bank_ids[0] # res.partner.bank
seller = self.company_id
seller_bank = seller.bank_ids[0]

# ctx keys must be declared in this xml
ctx = {
    "contract_number": self.name,
    "date_conclusion": self.date_conclusion_fix or self.date_conclusion,

    "seller_name": seller.name,
    "seller_company_form": seller.company_form,
    "seller_representer_name": seller.representative_id.name,
    "seller_representer_name_parent": seller.representative_id.name_parent_case,
    "seller_representer_name_initials": seller.representative_id.name_initials_case,
    "seller_representer_document_parent": seller.representative_id.representative_document,
    "seller_inn": seller.vat,
    "seller_kpp": seller.iec,
    "seller_ogrn": seller.psrn,
    "seller_business_address": seller.full_address,
    "seller_phone": seller.phone,
    "seller_email": seller.email,

    "partner_name": partner.name,
    "partner_inn": partner.vat,
    "partner_business_address": partner.full_address,
    "partner_phone": partner.phone,
    "partner_email": partner.email,
}

if partner_bank:
    ctx.update({
        "partner_rs": partner_bank.acc_number,
        "partner_ks": partner_bank.bank_id.corr_account,
        "partner_bic": partner_bank.bank_id.bic,
    })
if seller_bank:
    ctx.update({
        "seller_rs": seller_bank.acc_number,
        "seller_ks": seller_bank.bank_id.corr_account,
        "seller_bic": seller_bank.bank_id.bic,
    })


# Person
if not partner.is_company:
    ctx.update({
        "partner_name_initials": partner.name_initials_case, # TODO: remove 'case'
        "partner_passport_number": partner.passport_number,
        "partner_passport_date": partner.passport_date,
        "partner_passport_department": partner.passport_department,
    })
else:
    # Company
    ctx.update({
        "partner_company_form": partner.company_form,
        "partner_representer_name": partner.representative_id.name,
        "partner_representer_name_parent": partner.representative_id.name_parent_case,
        "partner_representer_name_initials": partner.representative_id.name_initials_case,
        "partner_representer_document_parent": partner.representative_id.representative_document,
    })

    if partner.company_form == 'sp':
        # Sole Proprietor
        ctx.update({
            "partner_ip_number": partner.sp_register_number,
            "partner_ip_date": partner.sp_register_date,
            "partner_ogrnip": partner.psrn_sp,
        })
    if partner.company_form == 'plc':
        # Private Limited Company
        ctx.update({
            "partner_kpp": partner.iec,
            "partner_ogrn": partner.psrn,
        })


action = ctx
            </field>
        </record>


        <!-- Action -->
        <record id="action_get_annex_context" model="ir.actions.server">
            <field name="name">Generate Context for Contract</field>
            <field name="model_id" ref="client_contracts.model_res_partner_contract_wizard"/>
            <field name="binding_model_id" ref="client_contracts.model_res_partner_contract_wizard" />
            <field name="state">code</field>
            <field name="code">

# Aliases
self = record
order = self.order_id
seller = self.contract_id.company_id
partner = self.contract_id.partner_id

# Functions
modf = self.modf

# ctx keys must be decalared in this xml
ctx = {
    "contract_number": self.contract_id.name,

    "amount_whole": 0,
    "amount_fractional": 0,

    "payment_term": False,
    "delivery_time": False,

    "seller_company_name": seller.name,
    "seller_representer_name": seller.representative_id.name,
    "seller_representer_function": seller.representative_id.function,

    "partner_company_name": partner.name,
    "partner_representer_name": partner.representative_id.name,
    "partner_representer_function": partner.representative_id.function,
}

if order:
    amount = modf(order.amount_total)
    fractional, whole = amount

    payment_term = order.payment_term_id.name
    payment_term = payment_term and payment_term.lower()
    delivery_time = order.delivery_time

    ctx.update({
        "amount_whole": whole,
        "amount_fractional": fractional,

        "payment_term": payment_term,
        "delivery_time": delivery_time,
    })

action = ctx
            </field>
        </record>


        <!-- Common fields -->

        <record id="contract_field_contract_number" model="res.partner.contract.field">
            <field name="name">Contract Number</field>
            <field name="technical_name">contract_number</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_contract_conclusion_date" model="res.partner.contract.field">
            <field name="name">Conclusion Date</field>
            <field name="technical_name">date_conclusion</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_amount_whole" model="res.partner.contract.field">
            <field name="name">Amount Whole Part</field>
            <field name="technical_name">amount_whole</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_amount_fractional" model="res.partner.contract.field">
            <field name="name">Amount Fractional Part</field>
            <field name="technical_name">amount_fractional</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_delivery_time" model="res.partner.contract.field">
            <field name="name">Delivery Time</field>
            <field name="technical_name">delivery_time</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_payment_term" model="res.partner.contract.field">
            <field name="name">Payment Term</field>
            <field name="technical_name">payment_term</field>
            <field name="description"></field>
        </record>


        <!-- Seller -->

        <record id="contract_field_seller_name" model="res.partner.contract.field">
            <field name="name">Seller Name</field>
            <field name="technical_name">seller_name</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_company_form" model="res.partner.contract.field">
            <field name="name">Seller Institutional-Legal Form</field>
            <field name="technical_name">seller_company_form</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_business_address" model="res.partner.contract.field">
            <field name="name">Seller Business Address</field>
            <field name="technical_name">seller_business_address</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_name" model="res.partner.contract.field">
            <field name="name">Seller Representer Name</field>
            <field name="technical_name">seller_representer_name</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_name_parent" model="res.partner.contract.field">
            <field name="name">Seller Representer Parent Name</field>
            <field name="technical_name">seller_representer_name_parent</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_name_initials" model="res.partner.contract.field">
            <field name="name">Seller Representer Initials Name</field>
            <field name="technical_name">seller_representer_name_initials</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_document" model="res.partner.contract.field">
            <field name="name">Seller Representer Document Parent</field>
            <field name="technical_name">seller_representer_document_parent</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_function" model="res.partner.contract.field">
            <field name="name">Seller Representer Function</field>
            <field name="technical_name">seller_representer_function</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_function_parent" model="res.partner.contract.field">
            <field name="name">Seller Representer Function Parent Case</field>
            <field name="technical_name">seller_representer_function_parent</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_passport_number" model="res.partner.contract.field">
            <field name="name">Seller Representer Passport Number</field>
            <field name="technical_name">seller_representer_passport_number</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_passport_date" model="res.partner.contract.field">
            <field name="name">Seller Representer Passport Date</field>
            <field name="technical_name">seller_representer_passport_date</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_representer_passport_department" model="res.partner.contract.field">
            <field name="name">Seller Representer Passport Department</field>
            <field name="technical_name">seller_representer_passport_department</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_ip_number" model="res.partner.contract.field">
            <field name="name">Seller IP Number</field>
            <field name="technical_name">seller_ip_number</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_ip_date" model="res.partner.contract.field">
            <field name="name">Seller IP Date</field>
            <field name="technical_name">seller_ip_date</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_inn" model="res.partner.contract.field">
            <field name="name">Seller INN</field>
            <field name="technical_name">seller_inn</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_kpp" model="res.partner.contract.field">
            <field name="name">Seller KPP</field>
            <field name="technical_name">seller_kpp</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_bic" model="res.partner.contract.field">
            <field name="name">Seller BIC</field>
            <field name="technical_name">seller_bic</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_psrn" model="res.partner.contract.field">
            <field name="name">Seller PSRN</field>
            <field name="technical_name">seller_ogrn</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_bank" model="res.partner.contract.field">
            <field name="name">Seller Bank Name</field>
            <field name="technical_name">seller_bank</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_bank_account" model="res.partner.contract.field">
            <field name="name">Seller Bank Account</field>
            <field name="technical_name">seller_bank_account</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_seller_phone" model="res.partner.contract.field">
            <field name="name">Seller Phone</field>
            <field name="technical_name">seller_phone</field>
            <field name="description"></field>
        </record>


        <!-- Partner -->

        <record id="contract_field_partner_name" model="res.partner.contract.field">
            <field name="name">Partner Name</field>
            <field name="technical_name">partner_name</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_company_form" model="res.partner.contract.field">
            <field name="name">Partner Institutional-Legal Form</field>
            <field name="technical_name">partner_company_form</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_business_address" model="res.partner.contract.field">
            <field name="name">Partner Business Address</field>
            <field name="technical_name">partner_business_address</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_name" model="res.partner.contract.field">
            <field name="name">Partner Representer Name</field>
            <field name="technical_name">partner_representer_name</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_name_parent" model="res.partner.contract.field">
            <field name="name">Partner Representer Parent Name</field>
            <field name="technical_name">partner_representer_name_parent</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_name_initials" model="res.partner.contract.field">
            <field name="name">Partner Representer Initials Name</field>
            <field name="technical_name">partner_representer_name_initials</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_document" model="res.partner.contract.field">
            <field name="name">Partner Representer Document Parent</field>
            <field name="technical_name">partner_representer_document_parent</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_function" model="res.partner.contract.field">
            <field name="name">Partner Representer Function</field>
            <field name="technical_name">partner_representer_function</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_function_parent" model="res.partner.contract.field">
            <field name="name">Partner Representer Function Parent Case</field>
            <field name="technical_name">partner_representer_function_parent</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_passport_number" model="res.partner.contract.field">
            <field name="name">Partner Representer Passport Number</field>
            <field name="technical_name">partner_representer_passport_number</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_passport_date" model="res.partner.contract.field">
            <field name="name">Partner Representer Passport Date</field>
            <field name="technical_name">partner_representer_passport_date</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_representer_passport_department" model="res.partner.contract.field">
            <field name="name">Partner Representer Passport Department</field>
            <field name="technical_name">partner_representer_passport_department</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_ip_number" model="res.partner.contract.field">
            <field name="name">Partner IP Number</field>
            <field name="technical_name">partner_ip_number</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_ip_date" model="res.partner.contract.field">
            <field name="name">Partner IP Date</field>
            <field name="technical_name">partner_ip_date</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_inn" model="res.partner.contract.field">
            <field name="name">Partner INN</field>
            <field name="technical_name">partner_inn</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_kpp" model="res.partner.contract.field">
            <field name="name">Partner KPP</field>
            <field name="technical_name">partner_kpp</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_bic" model="res.partner.contract.field">
            <field name="name">Partner BIC</field>
            <field name="technical_name">partner_bic</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_psrn" model="res.partner.contract.field">
            <field name="name">Partner PSRN</field>
            <field name="technical_name">partner_ogrn</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_bank" model="res.partner.contract.field">
            <field name="name">Partner Bank Name</field>
            <field name="technical_name">partner_bank</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_bank_account" model="res.partner.contract.field">
            <field name="name">Partner Bank Account</field>
            <field name="technical_name">partner_bank_account</field>
            <field name="description"></field>
        </record>

        <record id="contract_field_partner_phone" model="res.partner.contract.field">
            <field name="name">Partner Phone</field>
            <field name="technical_name">partner_phone</field>
            <field name="description"></field>
        </record>

    </data>
</odoo>
